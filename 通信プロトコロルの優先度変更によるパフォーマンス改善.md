# 通信プロトコロルの優先度変更によるパフォーマンス改善

IPv4 プロトコルのみ使用するプライベートネットワークで構成されたシステムで、  
パフォーマンスの改善が見込める可能性がある(業務系ターミナルだと割とある印象)。

パフォーマンス自体はそれぞれの実システムで計測する必要がある。  
ここではプロトコル優先度変更手順だけまとめる。

- 1.現在のプロトコル優先を確認する。
  　　※説明列は追記しています。

```
netsh interface ipv6 show prefixpolicies

優先順位   ラベル  プレフィックス    説明
----------  -----  -------------  -----------------
        50      0  ::1/128        ループバック(localhost)
        40      1  ::/0           IPv6
        35      4  ::ffff:0:0/96  IPv4射影アドレス
        30      2  2002::/16　　　 6to4
         5      5  2001::/32      Teredo
         3     13  fc00::/7       ユニークローカルユニキャストアドレス
         1     11  fec0::/10      サイトローカルユニキャストアドレス(廃止)
         1     12  3ffe::/16      6bone(廃止)
         1      3  ::/96　　　　　 IPv4互換アドレス（廃止）
```

- 2.ping で確認してみる。

```
ping localhost

DESKTOP-***** [::1]に ping を送信しています 32 バイトのデータ:
::1 からの応答: 時間 <1ms
::1 からの応答: 時間 <1ms
::1 からの応答: 時間 <1ms
::1 からの応答: 時間 <1ms

::1 の ping 統計:
    パケット数: 送信 = 4、受信 = 4、損失 = 0 (0% の損失)、
ラウンド トリップの概算時間 (ミリ秒):
    最小 = 0ms、最大 = 0ms、平均 = 0ms
```

- 3.IPv4 を最優先に変えます

```
netsh interface ipv6 set prefixpolicy ::ffff:0:0/96 55 4
```

- 4.変更内容を確認します

```
netsh interface ipv6 show prefixpolicies
アクティブ状態を照会しています...

優先順位   ラベル  プレフィックス
----------  -----  --------------------------------
        55      4  ::ffff:0:0/96
        50      0  ::1/128
        40      1  ::/0
        30      2  2002::/16
         5      5  2001::/32
         3     13  fc00::/7
         1     11  fec0::/10
         1     12  3ffe::/16
         1      3  ::/96
```

- 5.ping で確認してみる。

```
ping localhost

DESKTOP-L18OTEK [127.0.0.1]に ping を送信しています 32 バイトのデータ:
127.0.0.1 からの応答: バイト数 =32 時間 <1ms TTL=128
127.0.0.1 からの応答: バイト数 =32 時間 <1ms TTL=128
127.0.0.1 からの応答: バイト数 =32 時間 <1ms TTL=128
127.0.0.1 からの応答: バイト数 =32 時間 <1ms TTL=128

127.0.0.1 の ping 統計:
    パケット数: 送信 = 4、受信 = 4、損失 = 0 (0% の損失)、
ラウンド トリップの概算時間 (ミリ秒):
    最小 = 0ms、最大 = 0ms、平均 = 0ms
```

- 6.実験後は初期値に戻す

```
netsh interface ipv6 reset
コンパートメントの転送 のリセットに成功しました。
コンパートメント のリセットに成功しました。
制御プロトコル のリセットに成功しました。
エコー シーケンス要求 のリセットに成功しました。
グローバル のリセットに成功しました。
インターフェイス のリセットに成功しました。
エニーキャスト アドレス のリセットに成功しました。
マルチキャスト アドレス のリセットに成功しました。
ユニキャスト アドレス のリセットに成功しました。
近隣 のリセットに成功しました。
パス のリセットに成功しました。
可能性 のリセットに成功しました。
プレフィックス ポリシー のリセットに成功しました。
プロキシの近隣 のリセットに成功しました。
ルート のリセットに成功しました。
サイト プレフィックス のリセットに成功しました。
サブインターフェイス のリセットに成功しました。
スリープ解除のパターン のリセットに成功しました。
近隣の解決 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに失敗しました。
アクセスが拒否されました。

 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
 のリセットに成功しました。
コンピューターを再起動してこの操作を完了してください。
```

- 7.PC 再起動後、プロトコル優先度が初期値に戻っていることを確認します。

```
netsh interface ipv6 show prefixpolicies
アクティブ状態を照会しています...

優先順位   ラベル  プレフィックス
----------  -----  --------------------------------
        50      0  ::1/128
        40      1  ::/0
        35      4  ::ffff:0:0/96
        30      2  2002::/16
         5      5  2001::/32
         3     13  fc00::/7
         1     11  fec0::/10
         1     12  3ffe::/16
         1      3  ::/96
```

* 8.最後にping動作も確認します。

```
ping localhost

DESKTOP-****** [::1]に ping を送信しています 32 バイトのデータ:
::1 からの応答: 時間 <1ms
::1 からの応答: 時間 <1ms
::1 からの応答: 時間 =1ms
::1 からの応答: 時間 <1ms

::1 の ping 統計:
    パケット数: 送信 = 4、受信 = 4、損失 = 0 (0% の損失)、
ラウンド トリップの概算時間 (ミリ秒):
    最小 = 0ms、最大 = 1ms、平均 = 0ms
```