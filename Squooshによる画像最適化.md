# 画像最適化

### ■静的画像について
2018 年に Google が公開した画像最適化アプリ Squoosh を使用します。

- 1.オンラインで最適化出来ますが、会社使用を想定し、セキュアなローカルでの最適化を試します。まずは、[ホームページ](https://squoosh.app/)の右上からアプリをダウンロードして、インストールします。

![squoosh app_](https://user-images.githubusercontent.com/49807271/193400365-be18e322-03e1-4142-b3ed-1b32a27e389b.png)

- 2.最適化したい画像を中央にドラッグオンドロップします。  
  ![2](https://user-images.githubusercontent.com/49807271/193400882-25c97f3b-9315-41c9-9989-df14c3ef6793.png)

- 3.最適化の設定をします。項目は沢山あるので都度色々試す必要がありそうです。効果が大きいのは、フォーマットの変更、リサイズ、クオリティダウンあたりかなと思います。  
  左がオリジナルイメージで右が最適化後のイメージです。

- 4.最適化イメージの設定が終わったら、右下のダウンロードアイコンを押して、最適化イメージをダウンロードします。  
  ※後述するコマンドでも最適化は可能ですが、ツールの方が見た目を確認しながら画像作成できるので便利です
  
### ■動的画像について
プログラムから動的にファイルを出力する場合、CLIでの生成が可能です。  
とはいえ、一度、最適化前の画像が作成してから変換する必要があるので非効率です。  
がっつり最適化したいのであれば、プログラムにMozJpg等を組み込むことになるかと思います。

* 1.バイナリーを次のURLからダウンロードして解凍します。  
　※現状、LinuxとWindowsのバイナリが配布されています。  
 https://mozjpeg.codelove.de/binaries.html
 
* 2.最適化したい画像ファイルをダウンロードした最適化プログラムに渡します。  
  プログラムの最適化手段は大きくわけて２つあります。  
  * cjpeg.exeによる劣化ありの圧縮
  * jpegtran.exeよる劣化なしの圧縮(恐らくメタデータの削除を実施)

```cmd
--cjpeg
cjpeg.exe -quality 80 origin.jpg > cjpeg.jpg
--jpegtran
jpegtran.exe origin.jpg > jpegtran.jpg
```
